---
output: 
  github_document:
    toc: false
    fig_width: 10.08
    fig_height: 6
editor_options: 
  chunk_output_type: console
---


```{r, echo = FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(cowplot)
library(easystats)

options(digits=2)

knitr::opts_chunk$set(
  collapse = TRUE,
  dpi=450,
  fig.path = "figures/"
)
```

# How to Preprocess ECG, RSP and EDA Signals: A Simulation Study



## Respiration (RSP)

### Convenience Functions

<details><summary>See code</summary>
<p>
```{r, echo = TRUE, warning=FALSE, message=FALSE}
plot_effectnoise <- function(df){
  
  geoms <- function(p){
    p + 
      geom_point2(size=2, alpha=0.1) +
      theme_modern() +
      scale_color_viridis_c()
  }
  
  fig1 <- geoms(ggplot(df, aes(x = Noise_Frequency, y = Difference_Rate_Mean, color=Noise_Amplitude)))
  fig2 <- geoms(ggplot(df, aes(x = Noise_Amplitude, y = Difference_Rate_Mean, color=Noise_Frequency)))
  fig3 <- geoms(ggplot(df, aes(x = Noise_Frequency, y = Difference_Cleaned_Mean, color=Noise_Amplitude)))
  fig4 <- geoms(ggplot(df, aes(x = Noise_Amplitude, y = Difference_Cleaned_Mean, color=Noise_Frequency)))
  
  cowplot::plot_grid(fig1, fig2, fig3, fig4, nrow=2)
}
```
</p>
</details>



### Filtering

<details><summary>See code</summary>
<p>
```{r, echo = TRUE, warning=FALSE, message=FALSE}
df <- read.csv("data_RSP_filtering.csv")

plot_effectnoise(df)
```
</p>
</details>


#### Filter Type

##### Effect on Signal
<details><summary>See code</summary>
<p>
```{r, echo = TRUE, warning=FALSE, message=FALSE}
model <- lm(Difference_Cleaned_Mean ~ Filter_Type + (poly(Noise_Amplitude, 2) * poly(Noise_Frequency, 2)), data=df) 

table <- model %>%
  parameters::model_parameters()

fig <- model %>% 
  estimate_means() %>% 
  ggplot(aes(x = Filter_Type, y = Mean)) +
  geom_line(aes(group=1), position = position_dodge(width = 0.2)) +
  geom_pointrange(aes(ymin=CI_low, ymax=CI_high), position = position_dodge(width = 0.2)) +
  theme_modern() +
  ylab("Mean Difference")
```
</p>
</details>
```{r, echo = FALSE, warning=FALSE, message=FALSE}
table[stringr::str_detect(table$Parameter, "Filter_Type"),]
fig
```



##### Effect on Rate
<details><summary>See code</summary>
<p>
```{r, echo = TRUE, warning=FALSE, message=FALSE}
model <- lm(Difference_Rate_Mean ~ Filter_Type + (poly(Noise_Amplitude, 2) * poly(Noise_Frequency, 2)), data=df) 

table <- model %>%
  parameters::model_parameters()

fig <- model %>% 
  estimate_means() %>% 
  ggplot(aes(x = Filter_Type, y = Mean)) +
  geom_line(aes(group=1), position = position_dodge(width = 0.2)) +
  geom_pointrange(aes(ymin=CI_low, ymax=CI_high), position = position_dodge(width = 0.2)) +
  theme_modern() +
  ylab("Mean Difference")
```
</p>
</details>
```{r, echo = FALSE, warning=FALSE, message=FALSE}
table[stringr::str_detect(table$Parameter, "Filter_Type"),]
fig
```

#### Filter Highcut

##### Effect on Signal
<details><summary>See code</summary>
<p>
```{r, echo = TRUE, warning=FALSE, message=FALSE}
model <- lm(Difference_Cleaned_Mean ~ Filter_Type * Filter_High + (poly(Noise_Amplitude, 2) * poly(Noise_Frequency, 2)), data=df) 

table <- model %>%
  parameters::model_parameters()

fig <- model %>% 
  estimate_link(target=c("Filter_Type", "Filter_High")) %>% 
  ggplot(aes(x = Filter_High, y = Predicted, color=Filter_Type)) +
  geom_line(aes(group=Filter_Type), position = position_dodge(width = 0.2)) +
  # geom_pointrange(aes(ymin=CI_low, ymax=CI_high), position = position_dodge(width = 0.2)) +
  theme_modern() +
  ylab("Mean Difference")
```
</p>
</details>
```{r, echo = FALSE, warning=FALSE, message=FALSE}
table[stringr::str_detect(table$Parameter, "Detrend"),]
fig
```



##### Effect on Rate
<details><summary>See code</summary>
<p>
```{r, echo = TRUE, warning=FALSE, message=FALSE}
model <- lm(Difference_Rate_Mean ~ Filter_Type * Filter_High + (poly(Noise_Amplitude, 2) * poly(Noise_Frequency, 2)), data=df) 

table <- model %>%
  parameters::model_parameters()

fig <- model %>% 
  estimate_link(target=c("Filter_Type", "Filter_High")) %>% 
  ggplot(aes(x = Filter_High, y = Predicted, color=Filter_Type)) +
  geom_line(aes(group=Filter_Type), position = position_dodge(width = 0.2)) +
  # geom_pointrange(aes(ymin=CI_low, ymax=CI_high), position = position_dodge(width = 0.2)) +
  theme_modern() +
  ylab("Mean Difference")
```
</p>
</details>
```{r, echo = FALSE, warning=FALSE, message=FALSE}
table[stringr::str_detect(table$Parameter, "Detrend"),]
fig
```
