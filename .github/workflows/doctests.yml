name: Doctests

# on: [push, pull_request]
on: pull_request

jobs:
  build:
    runs-on: ${{ matrix.platform }}
    strategy:
      max-parallel: 4
      matrix:
        # https://help.github.com/articles/virtual-environments-for-github-actions
        platform:
          - ubuntu-latest  # ubuntu-18.04
          - macos-latest  # macOS-10.14
        #  - windows-latest  # windows-2019
        python-version: [3.7, 3.8]
        #exclude:
        #  - platform: windows-latest
        #    python-version: 3.8

    steps:
    - uses: actions/checkout@master
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python-version }}
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        
    - name: Test with pytest
      run: |
        # Install test deps
        pip install numpy
        pip install pandas
        pip install scipy
        pip install sklearn
        pip install matplotlib
        pip install bioread
        pip install mne
        pip install pyentrp
        pip install nolds
        pip install biosppy
        pip install PyWavelets
        pip install cvxopt
        pip install EMD-signal
        # Test
        pip install pytest
        python setup.py install
        pytest --doctest-glob='*.py' neurokit2/bio -v
        pytest --doctest-glob='*.py' neurokit2/complexity -v
        pytest --doctest-glob='*.py' neurokit2/data -v
        pytest --doctest-glob='*.py' neurokit2/ecg -v
        pytest --doctest-glob='*.py' neurokit2/eda -v
        pytest --doctest-glob='*.py' neurokit2/eeg -v
        pytest --doctest-glob='*.py' neurokit2/emg -v
        pytest --doctest-glob='*.py' neurokit2/epochs -v
        pytest --doctest-glob='*.py' neurokit2/events -v
        pytest --doctest-glob='*.py' neurokit2/hrv -v
        pytest --doctest-glob='*.py' neurokit2/misc -v
        pytest --doctest-glob='*.py' neurokit2/ppg -v
        pytest --doctest-glob='*.py' neurokit2/rsp -v
        pytest --doctest-glob='*.py' neurokit2/signal -v
        pytest --doctest-glob='*.py' neurokit2/stats -v
